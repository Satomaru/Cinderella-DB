<!doctype html>

<html xmlns:th="http://www.thymeleaf.org" lang="ja">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<title>Idols - Cinderella DB</title>

		<style>
			td.type-Cu {
				font-weight: bold;
				color: #f88;
			}

			td.type-Pa {
				font-weight: bold;
				color: #bb0;
			}

			td.type-Co {
				font-weight: bold;
				color: #44f;
			}
		</style>

		<script>
			function request() {
				const kana = document.forms.search.kana.value;
				const type = document.forms.search.type.value;
				const tbody = document.getElementById("idolList").getElementsByTagName("tbody")[0];

				fetch(`../api/idols/?kana=${kana}&type=${type}`)
					.then(function(response){
						if (response.status == 500) {
							throw `検索に失敗しました。(${response.statusText})`;
						}

						return response.text();
					})
					.then(function(text) {
						tbody.innerText = null;

						JSON.parse(text).forEach(function(row) {
							const tdName = document.createElement("td");
							const tdKana = document.createElement("td");
							const tdType = document.createElement("td");
							const tdBirth = document.createElement("td");
							const tdCv = document.createElement("td");
							const tr = document.createElement("tr");

							tdName.innerText = row.name;
							tdName.className = `type-${row.type}`;
							tdKana.innerText = row.kana;
							tdType.innerText = row.type;
							tdBirth.innerText = row.birth.substring(0, 2) + "-" + row.birth.substring(2, 4);
							tdCv.innerText = row.cv;

							tr.appendChild(tdName);
							tr.appendChild(tdKana);
							tr.appendChild(tdType);
							tr.appendChild(tdBirth);
							tr.appendChild(tdCv);
							tbody.appendChild(tr);
						});
					})
					.catch(function(error) {
						alert(error);
					});
			}
		</script>
	</head>
	<body>
		<div class="col-lg-8 mx-auto">
			<div class="pt-3 pb-1 bg-white sticky-top">
				<header class="d-flex align-items-center mb-3 border-bottom">
					<h1 class="fs-4">Idols</h1>
				</header>

				<form name="search" action="#" class="h-100 p-2 mb-2 bg-light border rounded-3">
					<div class="row g-4 align-items-center">
						<div class="col-auto">
							<label for="kana" class="col-form-label">かな (部分一致)</label>
						</div>
						<div class="col-auto">
							<input type="text" id="kana" class="form-control" autofocus>
						</div>
						<div class="col-auto">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="type" id="typeAll" value="" checked>
								<label class="form-check-label" for="typeAll">All</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="type" id="typeCu" value="Cu">
								<label class="form-check-label" for="typeCu">Cu</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="type" id="typePa" value="Pa">
								<label class="form-check-label" for="typePa">Pa</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="type" id="typeCo" value="Co">
								<label class="form-check-label" for="typeCo">Co</label>
							</div>
						</div>
						<div class="col-auto">
							<button type="button" class="btn btn-primary" onclick="request()">検索</button>
						</div>
					</div>
				</form>
			</div>

			<table id="idolList" class="table">
				<thead>
					<tr>
						<th scope="col">名前</th>
						<th scope="col">かな</th>
						<th scope="col">タイプ</th>
						<th scope="col">誕生日</th>
						<th scope="col">CV</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	</body>
</html>

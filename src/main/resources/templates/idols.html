<!doctype html>

<html xmlns:th="http://www.thymeleaf.org" lang="ja">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<title>Idols - Cinderella</title>

		<script>
			function request() {
				const kana = document.forms.search.kana.value;
				const type = document.forms.search.type.value;

				fetch(`../api/idols/?kana=${kana}&type=${type}`)
					.then(function(response){
						if (response.status == 500) {
							throw `検索に失敗しました。(${response.status})`;
						}

						return response.text();
					})
					.then(function(text) {
						clearList();

						JSON.parse(text).forEach(function(row) {
							addList(row);
						});
					})
					.catch(function(error) {
						alert(error);
					});
			}

			function clearList() {
				document.getElementById("idolList").getElementsByTagName("tbody")[0].innerText = null;
			}

			function addList(row) {
				const name = document.createElement("td");
				name.innerText = row.name;

				const kana = document.createElement("td");
				kana.innerText = row.kana;

				const type = document.createElement("td");
				type.innerText = row.type;

				const birth = document.createElement("td");
				birth.innerText = row.birth;

				const cv = document.createElement("td");
				cv.innerText = row.cv;

				const tr = document.createElement("tr");
				tr.appendChild(name);
				tr.appendChild(kana);
				tr.appendChild(type);
				tr.appendChild(birth);
				tr.appendChild(cv);

				document.getElementById("idolList").getElementsByTagName("tbody")[0].appendChild(tr);
			}
		</script>
	</head>
	<body>
		<div class="col-lg-8 mx-auto p-3 py-md-5">
			<header class="d-flex align-items-center mb-4 border-bottom">
				<h1 class="fs-4">Idols</h1>
			</header>

			<form name="search" class="h-100 p-2 bg-light border rounded-3">
				<div class="row g-3 align-items-center">
					<div class="col-auto">
						<label for="kana" class="col-form-label">かな (部分一致)</label>
					</div>
					<div class="col-auto">
						<input type="text" id="kana" class="form-control" autofocus>
					</div>
					<div class="col-auto">
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="type" id="typeAll" value="" checked>
							<label class="form-check-label" for="typeAll">All</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="type" id="typeCu" value="Cu">
							<label class="form-check-label" for="typeCu">Cu</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="type" id="typePa" value="Pa">
							<label class="form-check-label" for="typePa">Pa</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="type" id="typeCo" value="Co">
							<label class="form-check-label" for="typeCo">Co</label>
						</div>
					</div>
					<div class="col-auto">
						<button type="button" class="btn btn-primary" onclick="request()">検索</button>
					</div>
				</div>
			</form>

			<table id="idolList" class="table">
				<thead>
					<tr>
						<th scope="col">名前</th>
						<th scope="col">かな</th>
						<th scope="col">タイプ</th>
						<th scope="col">誕生日</th>
						<th scope="col">CV</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	</body>
</html>
